# RiffCard Phase 1 MVP â€” è¨­è¨ˆæ›¸ï¼ˆæ­£è¦ç‰ˆï¼‰

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: riffcard
**æœ€çµ‚æ›´æ–°**: 2026-02-20
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Approved
**å½¢å¼**: SDD Design (MUSUBI)

---

## 0. è¨­è¨ˆåˆ¤æ–­ã‚µãƒãƒª

Phase 1 MVP ã®è¨­è¨ˆã«ã‚ãŸã‚Šã€ä»¥ä¸‹3ã¤ã®è¨­è¨ˆåˆ¤æ–­ã‚’é©ç”¨ã™ã‚‹ã€‚
ã“ã‚Œã‚‰ã¯ imudak ç¢ºèªæ¸ˆã¿ã§ã‚ã‚Šã€requirements.ja.md ã®ä¸€éƒ¨è¦ä»¶ã‚’ä¿®æ­£ã—ã¦å®Ÿè£…ã™ã‚‹ã€‚

### DJ-001: ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ç°¡ç•¥åŒ–ï¼ˆNoteå±¤å»ƒæ­¢ï¼‰

- **æ±ºå®š**: Noteï¼ˆãƒãƒ¼ãƒˆãƒ–ãƒƒã‚¯ï¼‰å±¤ã‚’å»ƒæ­¢ã—ã€Phrase â†’ Take ã®2å±¤ãƒ•ãƒ©ãƒƒãƒˆæ§‹é€ ã«å¤‰æ›´
- **ç†ç”±**: MVP ã§ã¯æ›²å˜ä½ã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã¯ä¸è¦ã€‚ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ãŒãƒˆãƒƒãƒ—ç”»é¢ã«ãªã‚‹ã“ã¨ã§æ“ä½œãŒ1éšå±¤æ¸›ã‚Šã€ãƒ•ãƒ­ãƒ¼çŠ¶æ…‹ï¼ˆP8å‹•æ©Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã‚’é˜»å®³ã—ãªã„
- **å½±éŸ¿è¦ä»¶**: REQ-RC-DATA-001, DATA-003, DATA-005, UX-001, UX-005

### DJ-002: ç·´ç¿’ãƒ•ãƒ­ãƒ¼æœ€é©åŒ–

- **æ±ºå®š**:
  - åˆå›: ãƒ•ãƒ¬ãƒ¼ã‚ºç”»é¢ã‚’é–‹ã â†’ ãŠæ‰‹æœ¬ãŒè‡ªå‹•å†ç”Ÿã•ã‚Œã‚‹ â†’ ã€Œç·´ç¿’ã™ã‚‹ã€â†’ å³éŒ²éŸ³é–‹å§‹
  - 2å›ç›®ä»¥é™: ãŠæ‰‹æœ¬å†ç”Ÿã¯ä»»æ„ï¼ˆãƒœã‚¿ãƒ³ã‚ã‚Šï¼‰â†’ ã€Œç·´ç¿’ã™ã‚‹ã€â†’ å³éŒ²éŸ³é–‹å§‹
- **ç†ç”±**: åˆå›ã¯ãŠæ‰‹æœ¬ã‚’è´ã‹ã›ã¦ç·´ç¿’ã®æµã‚Œã‚’ç†è§£ã•ã›ã‚‹ã€‚2å›ç›®ä»¥é™ã¯æ…£ã‚Œã¦ã„ã‚‹ã®ã§å³ç·´ç¿’å¯èƒ½ã«ã™ã‚‹
- **å½±éŸ¿è¦ä»¶**: REQ-RC-UX-003, PLAY-001

### DJ-003: ãƒ•ãƒ¬ãƒ¼ã‚ºä½œæˆã®æ‘©æ“¦ã‚¼ãƒ­åŒ–

- **æ±ºå®š**: ãƒ•ãƒ¬ãƒ¼ã‚ºä½œæˆ = ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåï¼ˆã€Œãƒ•ãƒ¬ãƒ¼ã‚º1ã€ç­‰ï¼‰ã§å³ãŠæ‰‹æœ¬éŒ²éŸ³é–‹å§‹ã€‚ãƒ•ãƒ¬ãƒ¼ã‚ºåã¯å¾Œã‹ã‚‰ç·¨é›†å¯èƒ½
- **ç†ç”±**: åå‰å…¥åŠ›ã‚¹ãƒ†ãƒƒãƒ—ã‚’æŒŸã‚€ã¨ãƒ•ãƒ­ãƒ¼çŠ¶æ…‹ãŒé€”åˆ‡ã‚Œã‚‹ã€‚å‰æ‰•ã„é€²æ—åŠ¹æœï¼ˆP3å‹•æ©Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã§ã€Œã‚‚ã†å§‹ã¾ã£ã¦ã‚‹ã€æ„Ÿã‚’æ¼”å‡º
- **å½±éŸ¿è¦ä»¶**: REQ-RC-DATA-004, UX-002

---

## 1. è¦ä»¶ä¿®æ­£äº‹é …

è¨­è¨ˆåˆ¤æ–­ã«ã‚ˆã‚Šã€requirements.ja.md ã®ä»¥ä¸‹ã®è¦ä»¶ã‚’ä¿®æ­£ã—ã¦å®Ÿè£…ã™ã‚‹ã€‚

| è¦ä»¶ID | åŸæ–‡ï¼ˆæ¦‚è¦ï¼‰ | ä¿®æ­£å†…å®¹ | æ ¹æ‹  |
|--------|-------------|---------|------|
| DATA-001 | 3å±¤ãƒ¢ãƒ‡ãƒ«: Note â†’ Phrase â†’ Take | **2å±¤ãƒ¢ãƒ‡ãƒ«: Phrase â†’ Take** ã«å¤‰æ›´ã€‚Note ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’å»ƒæ­¢ | DJ-001 |
| DATA-003 | Noteä½œæˆ: ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›â†’ä¿å­˜ | **Phraseä½œæˆ**: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã§å³ä½œæˆâ†’ãŠæ‰‹æœ¬éŒ²éŸ³é–‹å§‹ | DJ-001, DJ-003 |
| DATA-004 | Phraseä½œæˆ: ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ›â†’éŒ²éŸ³æº–å‚™ | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåè‡ªå‹•ä»˜ä¸â†’**å³ãŠæ‰‹æœ¬éŒ²éŸ³é–‹å§‹**ï¼ˆåå‰å…¥åŠ›ãªã—ï¼‰ | DJ-003 |
| DATA-005 | Noteå‰Šé™¤â†’ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ | **Phraseå‰Šé™¤â†’é…ä¸‹Takeå…¨å‰Šé™¤**ã«å¤‰æ›´ | DJ-001 |
| UX-001 | åˆå›CTA:ã€Œãƒ•ãƒ¬ãƒ¼ã‚ºã‚’éŒ²éŸ³ã™ã‚‹ã€ | Noteä½œæˆã‚¹ãƒ†ãƒƒãƒ—ãªã—ã€‚**ã€Œãƒ•ãƒ¬ãƒ¼ã‚ºã‚’éŒ²éŸ³ã™ã‚‹ã€ã§Phraseä½œæˆ+å³éŒ²éŸ³** | DJ-001, DJ-003 |
| UX-005 | Noteç©ºçŠ¶æ…‹ã®è¡¨ç¤º | **Phraseç©ºçŠ¶æ…‹ã®è¡¨ç¤º**ã«å¤‰æ›´ | DJ-001 |

---

## 2. ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ¦‚è¦

### 2.1 C4 Level 1: System Context

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ãƒ¦ãƒ¼ã‚¶ãƒ¼       â”‚
â”‚  (ã‚¹ãƒãƒ› / PC)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTPS (åˆå›ãƒ­ãƒ¼ãƒ‰ã®ã¿)
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cloudflare     â”‚  é™çš„ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°
â”‚  Pages          â”‚  (HTML / CSS / JS)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ Service Worker ã«ã‚ˆã‚‹ã‚­ãƒ£ãƒƒã‚·ãƒ¥
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ãƒ–ãƒ©ã‚¦ã‚¶å†…                   â”‚
â”‚                                      â”‚
â”‚   RiffCard PWA                       â”‚
â”‚   ãƒ»ãƒ•ãƒ¬ãƒ¼ã‚ºç®¡ç†                      â”‚
â”‚   ãƒ»éŒ²éŸ³ï¼ˆãŠæ‰‹æœ¬ / ç·´ç¿’ï¼‰              â”‚
â”‚   ãƒ»ãƒ”ãƒƒãƒåˆ†æ & ã‚¹ã‚³ã‚¢è¡¨ç¤º            â”‚
â”‚   ãƒ»å…¨ãƒ‡ãƒ¼ã‚¿ IndexedDB ã«ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜   â”‚
â”‚                                      â”‚
â”‚   â€» ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãªã—           â”‚
â”‚   â€» å¤–éƒ¨APIå‘¼ã³å‡ºã—ãªã—              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å¤–éƒ¨ä¾å­˜ãªã—**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å…¨å‡¦ç†ãŒå®Œçµã™ã‚‹ã€‚éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã¯å¤–éƒ¨ã«é€ä¿¡ã—ãªã„ã€‚

### 2.2 C4 Level 2: Container Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ãƒ–ãƒ©ã‚¦ã‚¶                            â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   React SPA    â”‚     â”‚    Service Worker        â”‚  â”‚
â”‚  â”‚  (Vite build)  â”‚     â”‚    (Workbox / PWA)       â”‚  â”‚
â”‚  â”‚                â”‚     â”‚                         â”‚  â”‚
â”‚  â”‚  ãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°  â”‚     â”‚  ãƒ»ã‚¢ãƒ—ãƒªã‚·ã‚§ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥   â”‚  â”‚
â”‚  â”‚  ãƒ»UIæç”»       â”‚     â”‚  ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ         â”‚  â”‚
â”‚  â”‚  ãƒ»çŠ¶æ…‹ç®¡ç†     â”‚     â”‚  ãƒ»æ›´æ–°é€šçŸ¥              â”‚  â”‚
â”‚  â””â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚      â”‚    â”‚                                          â”‚
â”‚      â”‚    â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ IndexedDB  â”‚     â”‚   Web Audio Engine       â”‚     â”‚
â”‚  â”‚            â”‚     â”‚                          â”‚     â”‚
â”‚  â”‚ ãƒ»Phrase   â”‚     â”‚  ãƒ»MediaRecorder (éŒ²éŸ³)    â”‚     â”‚
â”‚  â”‚ ãƒ»Take     â”‚     â”‚  ãƒ»OfflineAudioContext    â”‚     â”‚
â”‚  â”‚ ãƒ»éŸ³å£°Blob â”‚     â”‚  ãƒ»Pitchy.js (ãƒ”ãƒƒãƒæ¤œå‡º)  â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  ãƒ»DTW (ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ)      â”‚     â”‚
â”‚                     â”‚  ãƒ»ã‚¹ã‚³ã‚¢è¨ˆç®—              â”‚     â”‚
â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| ã‚³ãƒ³ãƒ†ãƒŠ | æŠ€è¡“ | è²¬å‹™ | å¯¾å¿œè¦ä»¶ |
|---------|------|------|---------|
| React SPA | React 19 + TypeScript + Vite 6 | UIãƒ»ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ»çŠ¶æ…‹ç®¡ç† | UX-001ã€œ005, NFR-001ã€œ002 |
| IndexedDB Store | idb (Promise wrapper) | ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–ï¼ˆPhrase/Take + éŸ³å£°Blobï¼‰ | DATA-001ã€œ005 |
| Web Audio Engine | Web Audio API + Pitchy.js | éŒ²éŸ³ãƒ»ãƒ”ãƒƒãƒæ¤œå‡ºãƒ»ã‚¹ã‚³ã‚¢è¨ˆç®— | REC-001ã€œ006, PITCH-001ã€œ006 |
| Service Worker | vite-plugin-pwa (Workbox) | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ»æ›´æ–°é€šçŸ¥ | PWA-001ã€œ003 |

### 2.3 C4 Level 3: Component Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        React SPA                            â”‚
â”‚                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   Pages     â”‚  â”‚  Components â”‚  â”‚      Hooks          â”‚ â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚                     â”‚ â”‚
â”‚  â”‚ PhraseList  â”‚  â”‚ AudioRec.   â”‚  â”‚ usePhrases()        â”‚ â”‚
â”‚  â”‚ PhraseDetailâ”‚â”€â”€â”‚ AudioPlayer â”‚â”€â”€â”‚ useTakes()          â”‚ â”‚
â”‚  â”‚ RefRecord   â”‚  â”‚ ScoreDisp.  â”‚  â”‚ useRecorder()       â”‚ â”‚
â”‚  â”‚ PracRecord  â”‚  â”‚ WaveformViz â”‚  â”‚ useAnalyzer()       â”‚ â”‚
â”‚  â”‚ ScoreResult â”‚  â”‚ EmptyState  â”‚  â”‚ useServiceWorker()  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                â”‚            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                    Library Layer                â”‚            â”‚
â”‚                                                â”‚            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     lib/db           â”‚  â”‚       lib/audio              â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚                              â”‚ â”‚
â”‚  â”‚  PhraseRepository    â”‚  â”‚  AudioRecorder               â”‚ â”‚
â”‚  â”‚  TakeRepository      â”‚  â”‚  PitchAnalyzer               â”‚ â”‚
â”‚  â”‚  RiffCardDB schema   â”‚  â”‚  ScoreCalculator             â”‚ â”‚
â”‚  â”‚  types (Phrase,Take) â”‚  â”‚  DTW                         â”‚ â”‚
â”‚  â”‚                      â”‚  â”‚                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                             â”‚                 â”‚
â”‚             â–¼                             â–¼                 â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚      â”‚ IndexedDB  â”‚              â”‚ Web Audio API    â”‚       â”‚
â”‚      â”‚ (idb)      â”‚              â”‚ + Pitchy.js      â”‚       â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ãƒ‡ãƒ¼ã‚¿è¨­è¨ˆ

### 3.1 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾©

```typescript
// lib/db/src/types.ts

// REQ-RC-DATA-001 (ä¿®æ­£: 2å±¤ãƒ¢ãƒ‡ãƒ«)
interface Phrase {
  id: string;              // crypto.randomUUID()
  title: string;           // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã€Œãƒ•ãƒ¬ãƒ¼ã‚ºNã€ã€1-100æ–‡å­—ã€å¾Œã‹ã‚‰ç·¨é›†å¯èƒ½
  referenceAudioBlob: Blob | null;  // ãŠæ‰‹æœ¬éŸ³å£°ï¼ˆaudio/webm;codecs=opusï¼‰
  createdAt: Date;
  updatedAt: Date;
}

// REQ-RC-DATA-001
interface Take {
  id: string;              // crypto.randomUUID()
  phraseId: string;        // FK â†’ Phrase.id
  audioBlob: Blob;         // ç·´ç¿’éŸ³å£°ï¼ˆaudio/webm;codecs=opusï¼‰
  pitchScore: number;      // 0-100
  rhythmScore: number;     // 0-100
  totalScore: number;      // pitchScore * 0.7 + rhythmScore * 0.3
  recordedAt: Date;
}

// ã‚¹ã‚³ã‚¢è¨ˆç®—çµæœ
interface Scores {
  pitchScore: number;
  rhythmScore: number;
  totalScore: number;
}
```

### 3.2 IndexedDB ã‚¹ã‚­ãƒ¼ãƒ

```typescript
// lib/db/src/schema.ts
import { DBSchema } from 'idb';

interface RiffCardDB extends DBSchema {
  phrases: {
    key: string;           // Phrase.id (UUID)
    value: Phrase;
    indexes: {
      'by-created': Date;  // createdAt ã«ã‚ˆã‚‹ä¸¦ã³æ›¿ãˆ
    };
  };
  takes: {
    key: string;           // Take.id (UUID)
    value: Take;
    indexes: {
      'by-phrase': string;  // phraseId ã§æ¤œç´¢
      'by-recorded': Date;  // recordedAt ã«ã‚ˆã‚‹ä¸¦ã³æ›¿ãˆ
    };
  };
}

// DBåãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³
const DB_NAME = 'riffcard-db';
const DB_VERSION = 1;
```

**ADR-002: idb ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨**
- æ±ºå®š: IndexedDB ç›´æ¥æ“ä½œã§ã¯ãªã `idb` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- ç†ç”±: Promise APIã€å‹å®‰å…¨ã€ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šæ¸›
- Article VIII æº–æ‹ : idb ã¯è–„ã„ Promise ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã‚ã‚Šç‹¬è‡ªæŠ½è±¡åŒ–ã§ã¯ãªã„

### 3.3 ãƒªãƒã‚¸ãƒˆãƒªè¨­è¨ˆ

```typescript
// lib/db/src/repository.ts

// REQ-RC-DATA-002: IndexedDB ã«ã‚ˆã‚‹ CRUD
interface PhraseRepository {
  getAll(): Promise<Phrase[]>;
  getById(id: string): Promise<Phrase | undefined>;
  create(): Promise<Phrase>;                              // DJ-003: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã§å³ä½œæˆ
  updateTitle(id: string, title: string): Promise<void>;  // DJ-003: å¾Œã‹ã‚‰åå‰ç·¨é›†
  updateReference(id: string, blob: Blob): Promise<void>; // REC-004, REC-006
  delete(id: string): Promise<void>;                      // DATA-005: ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤
}

interface TakeRepository {
  getByPhraseId(phraseId: string): Promise<Take[]>;
  getById(id: string): Promise<Take | undefined>;
  create(phraseId: string, audioBlob: Blob, scores: Scores): Promise<Take>;
  getBestScore(phraseId: string): Promise<number | null>;
}
```

#### ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåç”Ÿæˆï¼ˆDJ-003ï¼‰

```typescript
// lib/db/src/repository.ts
async function generateDefaultTitle(db: IDBPDatabase<RiffCardDB>): Promise<string> {
  const count = await db.count('phrases');
  return `ãƒ•ãƒ¬ãƒ¼ã‚º${count + 1}`;
}
```

### 3.4 ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ï¼ˆREQ-RC-DATA-005 ä¿®æ­£ç‰ˆï¼‰

```
Phraseå‰Šé™¤ â†’ è©²å½“Phraseã®Takeå…¨å–å¾—
           â†’ Takeå…¨å‰Šé™¤
           â†’ Phraseå‰Šé™¤
           â€» IndexedDB ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§å®Ÿè¡Œ
```

---

## 4. ç”»é¢è¨­è¨ˆ

### 4.1 ç”»é¢ä¸€è¦§

| # | ç”»é¢å | ãƒ‘ã‚¹ | æ¦‚è¦ | å¯¾å¿œè¦ä»¶ |
|---|--------|------|------|---------|
| S1 | ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ï¼ˆãƒˆãƒƒãƒ—ï¼‰ | `/` | ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ã€‚ç©ºçŠ¶æ…‹CTAã€‚+ã§å³éŒ²éŸ³ | UX-001, UX-005, DATA-003 |
| S2 | ãŠæ‰‹æœ¬éŒ²éŸ³ | `/phrases/:id/reference` | å³éŒ²éŸ³é–‹å§‹ã€‚æ³¢å½¢è¡¨ç¤º | REC-001ã€œ004, DATA-004 |
| S3 | ãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´° | `/phrases/:id` | ãŠæ‰‹æœ¬å†ç”Ÿãƒ»ç·´ç¿’ãƒœã‚¿ãƒ³ãƒ»ãƒ†ã‚¤ã‚¯ä¸€è¦§ | PLAY-001, UX-003, REC-006 |
| S4 | ç·´ç¿’éŒ²éŸ³ | `/phrases/:id/practice` | å³éŒ²éŸ³é–‹å§‹ã€‚ãŠæ‰‹æœ¬å†ç”Ÿãƒœã‚¿ãƒ³ | REC-005 |
| S5 | ã‚¹ã‚³ã‚¢çµæœ | `/phrases/:id/result/:takeId` | ã‚¹ã‚³ã‚¢è¡¨ç¤º + ã‚‚ã†ä¸€åº¦ | PITCH-005, UX-004, PLAY-002 |

### 4.2 ç”»é¢ãƒ•ãƒ­ãƒ¼

```
[S1 ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§]
    â”‚
    â”‚ ã€Œ+ã€ãƒœã‚¿ãƒ³ï¼ˆDJ-003: ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã§Phraseå³ä½œæˆï¼‰
    â–¼
[S2 ãŠæ‰‹æœ¬éŒ²éŸ³] â”€â”€éŒ²éŸ³å®Œäº†â”€â”€â†’ [S3 ãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´°]
                                   â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚               â”‚
                   â”‚   åˆå›: ãŠæ‰‹æœ¬è‡ªå‹•å†ç”Ÿï¼ˆDJ-002ï¼‰
                   â”‚   2å›ç›®ã€œ: å†ç”Ÿãƒœã‚¿ãƒ³ã§ä»»æ„å†ç”Ÿ
                   â”‚               â”‚
                   â”‚     ã€Œç·´ç¿’ã™ã‚‹ã€â”‚
                   â”‚               â–¼
                   â”‚         [S4 ç·´ç¿’éŒ²éŸ³]
                   â”‚               â”‚
                   â”‚          éŒ²éŸ³åœæ­¢â†’è‡ªå‹•åˆ†æ
                   â”‚               â–¼
                   â”‚         [S5 ã‚¹ã‚³ã‚¢çµæœ]
                   â”‚               â”‚
                   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                   â”‚  â”‚            â”‚
                   â”‚  â”‚ã€Œã‚‚ã†ä¸€åº¦ã€ â”‚ã€Œæˆ»ã‚‹ã€
                   â”‚  â–¼            â–¼
                   â”‚ [S4]        [S3]
                   â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ã€Œå†éŒ²éŸ³ã€     â”‚ã€Œå‰Šé™¤ã€ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼‰
    â–¼              â–¼
  [S2]          [S1ã¸æˆ»ã‚‹]
```

### 4.3 å„ç”»é¢ã®è©³ç´°

#### S1: ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ï¼ˆãƒˆãƒƒãƒ—ç”»é¢ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RiffCard               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ ã‚µãƒ“é«˜éŸ³éƒ¨åˆ†       â”‚  â”‚
â”‚  â”‚ Best: 87ç‚¹         â”‚  â”‚
â”‚  â”‚        [â–¶][ç·´ç¿’ã™ã‚‹]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Aãƒ¡ãƒ­å‡ºã ã—        â”‚  â”‚
â”‚  â”‚ Best: --ç‚¹         â”‚  â”‚
â”‚  â”‚        [â–¶][ç·´ç¿’ã™ã‚‹]â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                         â”‚
â”‚                   [ï¼‹]  â”‚  â† FAB
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç©ºçŠ¶æ…‹ï¼ˆUX-001, UX-005 ä¿®æ­£ç‰ˆï¼‰:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  RiffCard               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚         ğŸ¤              â”‚
â”‚   ç·´ç¿’ã—ãŸã„ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’    â”‚
â”‚   éŒ²éŸ³ã—ã¾ã—ã‚‡ã†         â”‚
â”‚                         â”‚
â”‚  [æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ã‚ºã‚’éŒ²éŸ³]   â”‚ â† å˜ä¸€CTAï¼ˆUX-001ï¼‰
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ã€Œ+ã€ãƒœã‚¿ãƒ³ / CTA ã‚¿ãƒƒãƒ—**: Phrase ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã§å³ä½œæˆ â†’ S2 ã¸é·ç§»ï¼ˆDJ-003ï¼‰
- **ãƒ•ãƒ¬ãƒ¼ã‚ºã‚«ãƒ¼ãƒ‰ ã‚¿ãƒƒãƒ—**: S3ï¼ˆãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´°ï¼‰ã¸é·ç§»
- **ã€Œç·´ç¿’ã™ã‚‹ã€ãƒœã‚¿ãƒ³**: S4ï¼ˆç·´ç¿’éŒ²éŸ³ï¼‰ã¸ç›´è¡Œï¼ˆUX-003ï¼‰
- **é•·æŠ¼ã— / ã‚¹ãƒ¯ã‚¤ãƒ—**: å‰Šé™¤ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä»˜ãã€DATA-005ï¼‰

#### S2: ãŠæ‰‹æœ¬éŒ²éŸ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ãŠæ‰‹æœ¬ã‚’éŒ²éŸ³           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚   ãƒ•ãƒ¬ãƒ¼ã‚º1              â”‚ â† ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåè¡¨ç¤º
â”‚                         â”‚
â”‚        â—‰               â”‚
â”‚  ~~~æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³~~~ â”‚ â† å³éŒ²éŸ³é–‹å§‹
â”‚                         â”‚
â”‚      00:03              â”‚
â”‚   [ â¹ éŒ²éŸ³åœæ­¢ ]        â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **ç”»é¢é·ç§»ã¨åŒæ™‚ã«éŒ²éŸ³é–‹å§‹**ï¼ˆãƒã‚¤ã‚¯æ¨©é™ç¢ºèªå¾Œå³é–‹å§‹ï¼‰ï¼ˆDJ-003ï¼‰
- åå‰å…¥åŠ›ã‚¹ãƒ†ãƒƒãƒ—ãªã—
- éŒ²éŸ³ä¸­ã¯æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¡¨ç¤ºï¼ˆREC-003ï¼‰
- åœæ­¢ â†’ IndexedDB ä¿å­˜ â†’ S3 ã¸é·ç§»ï¼ˆREC-004ï¼‰

#### S3: ãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ãƒ•ãƒ¬ãƒ¼ã‚º1       [âœï¸]  â”‚ â† ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†ãƒœã‚¿ãƒ³
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚  ãŠæ‰‹æœ¬:                 â”‚
â”‚  [â–¶ å†ç”Ÿ] [ğŸ”„ å†éŒ²éŸ³]    â”‚
â”‚                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                         â”‚
â”‚  [ ğŸ¤ ç·´ç¿’ã™ã‚‹ ]         â”‚  â† å¤§ããªCTA
â”‚                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                         â”‚
â”‚  ç·´ç¿’å±¥æ­´:               â”‚
â”‚  #3  82ç‚¹  2/21 14:30   â”‚
â”‚  #2  75ç‚¹  2/21 14:28   â”‚
â”‚  #1  68ç‚¹  2/21 14:25   â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- **åˆå›é·ç§»æ™‚**: ãŠæ‰‹æœ¬ã‚’è‡ªå‹•å†ç”Ÿã™ã‚‹ï¼ˆDJ-002ï¼‰
- **2å›ç›®ä»¥é™**: è‡ªå‹•å†ç”Ÿã—ãªã„ã€‚å†ç”Ÿãƒœã‚¿ãƒ³ã§ä»»æ„å†ç”Ÿï¼ˆDJ-002ï¼‰
- **åˆå›åˆ¤å®š**: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ stateï¼ˆ`{ fromRecording: true }`ï¼‰ã§åˆ¤å®š
- ã‚¿ã‚¤ãƒˆãƒ«ç·¨é›†ï¼ˆDJ-003: âœï¸ ã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—ã§ inline editï¼‰
- ãŠæ‰‹æœ¬å†ç”Ÿï¼ˆPLAY-001ï¼‰
- å†éŒ²éŸ³ãƒœã‚¿ãƒ³ï¼ˆREC-006ï¼‰
- ã€Œç·´ç¿’ã™ã‚‹ã€ãŒæœ€å¤§ã® CTAï¼ˆUX-003ï¼‰
- ãƒ†ã‚¤ã‚¯ä¸€è¦§: ã‚¿ãƒƒãƒ—ã§éŸ³å£°å†ç”Ÿï¼ˆPLAY-002ï¼‰

#### S4: ç·´ç¿’éŒ²éŸ³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ç·´ç¿’ä¸­                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚     ã‚µãƒ“é«˜éŸ³éƒ¨åˆ†         â”‚
â”‚                         â”‚
â”‚  [â–¶ ãŠæ‰‹æœ¬ã‚’è´ã]        â”‚
â”‚                         â”‚
â”‚        â—‰               â”‚
â”‚  ~~~æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³~~~ â”‚ â† å³éŒ²éŸ³é–‹å§‹
â”‚                         â”‚
â”‚      00:05              â”‚
â”‚   [ â¹ éŒ²éŸ³åœæ­¢ ]        â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ç”»é¢é·ç§»ã¨åŒæ™‚ã«éŒ²éŸ³è‡ªå‹•é–‹å§‹ï¼ˆãƒã‚¤ã‚¯è¨±å¯æ¸ˆã¿ã®å ´åˆï¼‰
- ãŠæ‰‹æœ¬å†ç”Ÿãƒœã‚¿ãƒ³ã‚ã‚Šï¼ˆéŒ²éŸ³å‰ã«è´ã‘ã‚‹ï¼‰
- åœæ­¢ â†’ è‡ªå‹•ãƒ”ãƒƒãƒåˆ†æ â†’ S5 ã¸é·ç§»ï¼ˆREC-005ï¼‰

#### S5: ã‚¹ã‚³ã‚¢çµæœ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† çµæœ                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                         â”‚
â”‚        87               â”‚
â”‚        ç‚¹               â”‚
â”‚      å„ªç§€ï¼              â”‚
â”‚                         â”‚
â”‚  ãƒ”ãƒƒãƒç²¾åº¦:  91ç‚¹       â”‚
â”‚  ãƒªã‚ºãƒ ç²¾åº¦:  78ç‚¹       â”‚
â”‚                         â”‚
â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚
â”‚                         â”‚
â”‚  [ ğŸ¤ ã‚‚ã†ä¸€åº¦ ]        â”‚  â† ãƒ¡ã‚¤ãƒ³CTA
â”‚  [â–¶ éŒ²éŸ³ã‚’è´ã]          â”‚
â”‚  [ â† ãƒ•ãƒ¬ãƒ¼ã‚ºã«æˆ»ã‚‹ ]    â”‚
â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- ã‚¹ã‚³ã‚¢ã‚’å¤§ããè¡¨ç¤ºï¼ˆPITCH-005ï¼‰
- è©•ä¾¡ãƒ©ãƒ™ãƒ«: 90â†‘=å„ªç§€ / 70â†‘=è‰¯å¥½ / 50â†‘=ç·´ç¿’ä¸­ / 50æœªæº€=ãŒã‚“ã°ã‚ã†
- ã€Œã‚‚ã†ä¸€åº¦ã€ãŒãƒ¡ã‚¤ãƒ³CTAï¼ˆUX-004ï¼‰
- éŒ²éŸ³å†ç”Ÿå¯èƒ½ï¼ˆPLAY-002ï¼‰

### 4.4 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ–¹é‡

- **SPA**: React Router v7 ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- **æˆ»ã‚‹ãƒœã‚¿ãƒ³**: å…¨ç”»é¢ã«å·¦ä¸Šã® â† ã§è¦ªç”»é¢ã¸
- **ãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯å¯¾å¿œ**: History API ã§è‡ªç„¶ãªãƒ–ãƒ©ã‚¦ã‚¶ãƒãƒƒã‚¯
- **ã‚¿ãƒ–ãƒãƒ¼ãªã—**: éšå±¤ãŒæµ…ã„ã®ã§ã‚¹ã‚¿ãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã¿

---

## 5. éŸ³å£°å‡¦ç†ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### 5.1 éŒ²éŸ³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

```
ãƒã‚¤ã‚¯ â†’ getUserMedia â†’ MediaStream
                          â”‚
                    MediaRecorder
                    (audio/webm;codecs=opus)
                          â”‚
                     ondataavailable
                          â”‚
                      Blob â†’ IndexedDB ä¿å­˜
```

**ADR-003: MediaRecorder + opus/webm**
- æ±ºå®š: `audio/webm;codecs=opus` ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã€`audio/webm` ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- ç†ç”±: é«˜åœ§ç¸®ãƒ»é«˜å“è³ªã€Chrome/Firefox/Edge æ¨™æº–å¯¾å¿œ
- Safari å¯¾å¿œ: iOS 14.3+ ã§ MediaRecorder å¯¾å¿œæ¸ˆã¿ã€‚éå¯¾å¿œæ™‚ã¯ã‚¨ãƒ©ãƒ¼ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹è¡¨ç¤ºï¼ˆREC-002ï¼‰

### 5.2 ãƒ”ãƒƒãƒåˆ†æãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ï¼ˆã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‡¦ç†ï¼‰

```
éŸ³å£°Blob
  â”‚
  â–¼
OfflineAudioContext                      â† PITCH-006
  â”‚ decodeAudioData
  â–¼
AudioBuffer (PCM, 44.1kHz)
  â”‚
  â–¼
ãƒ•ãƒ¬ãƒ¼ãƒ åˆ†å‰² (4096 samples, 50% overlap)  â† PITCH-001
  â”‚
  â–¼
å„ãƒ•ãƒ¬ãƒ¼ãƒ ã«å¯¾ã—ã¦:
  â”œâ”€ ãƒãƒ‹ãƒ³ã‚°çª“é©ç”¨                       â† PITCH-001
  â”œâ”€ Pitchy.js ã§åŸºæœ¬å‘¨æ³¢æ•°æ¨å®š
  â”œâ”€ 80-1000Hz ç¯„å›²ãƒ•ã‚£ãƒ«ã‚¿              â† PITCH-001
  â””â”€ MIDIå¤‰æ›: 12*log2(f/440)+69        â† PITCH-002
  â”‚
  â–¼
ãƒ”ãƒƒãƒç³»åˆ— [f1, f2, f3, ...]
  â”‚
  â”œâ”€â†’ ãŠæ‰‹æœ¬ãƒ”ãƒƒãƒç³»åˆ—ã¨DTWã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
  â”‚   â””â”€â†’ Â±50centåˆ¤å®š â†’ pitchScore      â† PITCH-004
  â””â”€â†’ ãŠæ‰‹æœ¬ãƒªã‚ºãƒ ç³»åˆ—ã¨DTWã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
      â””â”€â†’ Â±100msåˆ¤å®š â†’ rhythmScore
  â”‚
  â–¼
totalScore = pitchScore * 0.7 + rhythmScore * 0.3  â† PITCH-003
```

### 5.3 ã‚¹ã‚³ã‚¢è¨ˆç®—è©³ç´°

#### ãƒ”ãƒƒãƒã‚¹ã‚³ã‚¢ï¼ˆ70%é‡ã¿ï¼‰

```typescript
// lib/audio/src/scoring.ts

function calcPitchScore(refPitches: number[], pracPitches: number[]): number {
  // DTWï¼ˆDynamic Time Warpingï¼‰ã§ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
  const aligned = alignByDTW(refPitches, pracPitches);

  // å„ãƒ•ãƒ¬ãƒ¼ãƒ ã®ã‚»ãƒ³ãƒˆå·®ã‚’è¨ˆç®—
  const centDiffs = aligned.map(([ref, prac]) =>
    1200 * Math.log2(prac / ref)
  );

  // Â±50cent ä»¥å†…ã‚’ã€Œæ­£ç¢ºã€ã¨ã‚«ã‚¦ãƒ³ãƒˆï¼ˆPITCH-004ï¼‰
  const accurateCount = centDiffs.filter(d => Math.abs(d) <= 50).length;

  return Math.round((accurateCount / centDiffs.length) * 100);
}
```

#### ãƒªã‚ºãƒ ã‚¹ã‚³ã‚¢ï¼ˆ30%é‡ã¿ï¼‰

```typescript
function calcRhythmScore(refOnsets: number[], pracOnsets: number[]): number {
  // ã‚ªãƒ³ã‚»ãƒƒãƒˆæ¤œå‡ºï¼ˆéŸ³ã®ç«‹ã¡ä¸ŠãŒã‚Šæ™‚åˆ»ï¼‰ã‚’æ¯”è¼ƒ
  const aligned = alignByDTW(refOnsets, pracOnsets);
  const timeDiffs = aligned.map(([r, p]) => Math.abs(p - r));
  // Â±100ms ä»¥å†…ã‚’ã€Œæ­£ç¢ºã€ã¨ã‚«ã‚¦ãƒ³ãƒˆ
  const accurateCount = timeDiffs.filter(d => d <= 0.1).length;
  return Math.round((accurateCount / timeDiffs.length) * 100);
}
```

**ADR-004: DTWï¼ˆDynamic Time Warpingï¼‰ä½¿ç”¨**
- æ±ºå®š: ãƒ†ãƒ³ãƒã®æºã‚Œã‚’å¸åã™ã‚‹ãŸã‚ DTW ã§ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
- ç†ç”±: ç·´ç¿’ãƒ†ã‚¤ã‚¯ã¯ãŠæ‰‹æœ¬ã¨å®Œå…¨ã«åŒã˜ãƒ†ãƒ³ãƒã«ãªã‚‰ãªã„ã€‚å›ºå®šã‚ªãƒ•ã‚»ãƒƒãƒˆã§ã¯ä¸æ­£ç¢º
- å®Ÿè£…: è»½é‡ DTW è‡ªå‰å®Ÿè£…ï¼ˆã€œ100ãƒ•ãƒ¬ãƒ¼ãƒ ç¨‹åº¦ãªã®ã§ O(nÂ²) ã§ååˆ†ï¼‰

---

## 6. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆï¼ˆLibrary-Firstï¼‰

### 6.1 ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ§‹æˆï¼ˆArticle Iï¼‰

```
lib/
â”œâ”€â”€ db/                          # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ index.ts             # Public API exports
â”‚   â”‚   â”œâ”€â”€ schema.ts            # IndexedDB ã‚¹ã‚­ãƒ¼ãƒå®šç¾©
â”‚   â”‚   â”œâ”€â”€ types.ts             # Phrase, Take å‹å®šç¾©
â”‚   â”‚   â”œâ”€â”€ repository.ts        # PhraseRepository, TakeRepository
â”‚   â”‚   â””â”€â”€ errors.ts            # StorageError ç­‰
â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â””â”€â”€ repository.test.ts   # fake-indexeddb ã§ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ cli.ts                   # Article II: CLI
â”‚
â””â”€â”€ audio/                       # éŸ³å£°å‡¦ç†å±¤
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ index.ts             # Public API exports
    â”‚   â”œâ”€â”€ types.ts             # AudioAnalysisResult, Scores ç­‰
    â”‚   â”œâ”€â”€ recorder.ts          # MediaRecorder ãƒ©ãƒƒãƒ‘ãƒ¼
    â”‚   â”œâ”€â”€ analyzer.ts          # OfflineAudioContext + Pitchy.js
    â”‚   â”œâ”€â”€ scoring.ts           # ãƒ”ãƒƒãƒ/ãƒªã‚ºãƒ ã‚¹ã‚³ã‚¢è¨ˆç®—
    â”‚   â”œâ”€â”€ dtw.ts               # Dynamic Time Warping
    â”‚   â””â”€â”€ errors.ts            # MicPermissionError ç­‰
    â”œâ”€â”€ tests/
    â”‚   â”œâ”€â”€ analyzer.test.ts
    â”‚   â”œâ”€â”€ scoring.test.ts
    â”‚   â””â”€â”€ dtw.test.ts
    â””â”€â”€ cli.ts                   # Article II: CLI
```

### 6.2 CLI ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆArticle IIï¼‰

#### lib/db CLI

```bash
npx tsx lib/db/cli.ts list-phrases
npx tsx lib/db/cli.ts create-phrase
npx tsx lib/db/cli.ts delete-phrase --id <uuid>
```

â€» Node.js ç’°å¢ƒã§ã¯ `fake-indexeddb` ã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ç”¨

#### lib/audio CLI

```bash
npx tsx lib/audio/cli.ts analyze --reference ref.webm --practice prac.webm
npx tsx lib/audio/cli.ts score --ref-pitches ref.json --prac-pitches prac.json
```

**ADR-009: CLI ã§ã® IndexedDB ä»£æ›¿**
- æ±ºå®š: CLI ãƒ†ã‚¹ãƒˆ/ãƒ‡ãƒãƒƒã‚°ç”¨ã« `fake-indexeddb` ã‚’ä½¿ç”¨
- ç†ç”±: IndexedDB ã¯ãƒ–ãƒ©ã‚¦ã‚¶å°‚ç”¨ APIã€‚CLIãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ã¯ fake-indexeddb ã§åŒä¸€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æä¾›
- Article IX æº–æ‹ : fake-indexeddb ã¯ IndexedDB ã®ä»•æ§˜æº–æ‹ å®Ÿè£…ã§ã‚ã‚Šã€ãƒ¢ãƒƒã‚¯ã§ã¯ãªã real service ã«ç›¸å½“

### 6.3 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤

```
app/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.tsx                 # ã‚¨ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ App.tsx                  # React Router ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ PhraseListPage.tsx   # S1: ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ï¼ˆãƒˆãƒƒãƒ—ï¼‰
â”‚   â”‚   â”œâ”€â”€ ReferenceRecordPage.tsx  # S2: ãŠæ‰‹æœ¬éŒ²éŸ³
â”‚   â”‚   â”œâ”€â”€ PhraseDetailPage.tsx # S3: ãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´°
â”‚   â”‚   â”œâ”€â”€ PracticeRecordPage.tsx   # S4: ç·´ç¿’éŒ²éŸ³
â”‚   â”‚   â””â”€â”€ ScoreResultPage.tsx  # S5: ã‚¹ã‚³ã‚¢çµæœ
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ AudioRecorder.tsx    # éŒ²éŸ³UIï¼ˆæ³¢å½¢ãƒ»ã‚¿ã‚¤ãƒãƒ¼ãƒ»é–‹å§‹/åœæ­¢ï¼‰
â”‚   â”‚   â”œâ”€â”€ AudioPlayer.tsx      # å†ç”ŸUIï¼ˆå†ç”Ÿ/ä¸€æ™‚åœæ­¢ãƒ»ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ï¼‰
â”‚   â”‚   â”œâ”€â”€ WaveformVisualizer.tsx  # Canvas æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ PhraseCard.tsx       # ãƒ•ãƒ¬ãƒ¼ã‚ºã‚«ãƒ¼ãƒ‰ï¼ˆä¸€è¦§ç”¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ TakeItem.tsx         # ãƒ†ã‚¤ã‚¯è¡Œï¼ˆã‚¹ã‚³ã‚¢ãƒ»æ—¥æ™‚ãƒ»å†ç”Ÿï¼‰
â”‚   â”‚   â”œâ”€â”€ ScoreDisplay.tsx     # ã‚¹ã‚³ã‚¢å¤§è¡¨ç¤º + è©•ä¾¡ãƒ©ãƒ™ãƒ«
â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx       # ç©ºçŠ¶æ…‹ CTA
â”‚   â”‚   â”œâ”€â”€ ConfirmDialog.tsx    # å‰Šé™¤ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
â”‚   â”‚   â””â”€â”€ BackButton.tsx       # â† æˆ»ã‚‹ãƒœã‚¿ãƒ³
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ usePhrases.ts        # PhraseRepository.getAll()
â”‚   â”‚   â”œâ”€â”€ usePhrase.ts         # PhraseRepository.getById()
â”‚   â”‚   â”œâ”€â”€ useTakes.ts          # TakeRepository.getByPhraseId()
â”‚   â”‚   â”œâ”€â”€ useRecorder.ts       # MediaRecorder åˆ¶å¾¡
â”‚   â”‚   â”œâ”€â”€ useAnalyzer.ts       # ãƒ”ãƒƒãƒåˆ†æå®Ÿè¡Œ
â”‚   â”‚   â””â”€â”€ useServiceWorker.ts  # SW æ›´æ–°é€šçŸ¥
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ global.css           # Tailwind CSS
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ manifest.json            # PWA ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”‚   â””â”€â”€ icons/
â”‚       â”œâ”€â”€ icon-192.png
â”‚       â””â”€â”€ icon-512.png
â””â”€â”€ index.html
```

### 6.4 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ„ãƒªãƒ¼

```
App
â”œâ”€â”€ Layout
â”‚
â”œâ”€â”€ PhraseListPage (S1, /)
â”‚   â”œâ”€â”€ PhraseList
â”‚   â”‚   â””â”€â”€ PhraseCard (title, bestScore, practiceButton, playButton)
â”‚   â”œâ”€â”€ EmptyState (UX-001, UX-005)
â”‚   â””â”€â”€ FAB [+]  â†’ Phraseå³ä½œæˆ â†’ S2ã¸
â”‚
â”œâ”€â”€ ReferenceRecordPage (S2, /phrases/:id/reference)
â”‚   â””â”€â”€ AudioRecorder (auto-start, waveform, timer, stop)
â”‚
â”œâ”€â”€ PhraseDetailPage (S3, /phrases/:id)
â”‚   â”œâ”€â”€ EditableTitle (DJ-003)
â”‚   â”œâ”€â”€ ReferencePlayer (åˆå›auto-play, play/re-record)
â”‚   â”œâ”€â”€ PracticeButton (å¤§CTA)
â”‚   â””â”€â”€ TakeList
â”‚       â””â”€â”€ TakeItem (score, date, playButton)
â”‚
â”œâ”€â”€ PracticeRecordPage (S4, /phrases/:id/practice)
â”‚   â”œâ”€â”€ ReferencePlayButton
â”‚   â””â”€â”€ AudioRecorder (auto-start, waveform, timer, stop)
â”‚
â””â”€â”€ ScoreResultPage (S5, /phrases/:id/result/:takeId)
    â”œâ”€â”€ ScoreDisplay (totalScore, label)
    â”œâ”€â”€ ScoreBreakdown (pitch, rhythm)
    â”œâ”€â”€ RetryButton (ã‚‚ã†ä¸€åº¦ â†’ S4)
    â”œâ”€â”€ PlaybackButton (éŒ²éŸ³ã‚’è´ã)
    â””â”€â”€ BackToPhrase (ãƒ•ãƒ¬ãƒ¼ã‚ºã«æˆ»ã‚‹ â†’ S3)
```

### 6.5 å…±é€šã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ

| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | è²¬å‹™ | ä½¿ç”¨ç”»é¢ |
|--------------|------|---------|
| `AudioRecorder` | éŒ²éŸ³ UIï¼ˆæ³¢å½¢ãƒ»ã‚¿ã‚¤ãƒãƒ¼ãƒ»åœæ­¢ãƒœã‚¿ãƒ³ï¼‰ | S2, S4 |
| `AudioPlayer` | å†ç”Ÿ UIï¼ˆå†ç”Ÿ/ä¸€æ™‚åœæ­¢ãƒ»ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼‰ | S3, S5 |
| `WaveformVisualizer` | Canvas æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ | AudioRecorder å†… |
| `ConfirmDialog` | ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚° | å‰Šé™¤æ“ä½œ |
| `BackButton` | â† æˆ»ã‚‹ãƒœã‚¿ãƒ³ | å…¨ç”»é¢ãƒ˜ãƒƒãƒ€ãƒ¼ |
| `EmptyState` | ç©ºçŠ¶æ…‹è¡¨ç¤º + CTA | S1 |

### 6.6 çŠ¶æ…‹ç®¡ç†

**ADR-005: React æ¨™æº–ï¼ˆuseState / useContextï¼‰ã®ã¿**
- æ±ºå®š: Redux / Zustand ç­‰ã®å¤–éƒ¨çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸ä½¿ç”¨
- ç†ç”±: ç”»é¢é–“ã§å…±æœ‰ã™ã‚‹çŠ¶æ…‹ãŒã»ã¼ãªã„ï¼ˆå„ç”»é¢ãŒ IndexedDB ã‹ã‚‰ç›´æ¥å–å¾—ï¼‰ã€‚Article VIII æº–æ‹ 
- ãƒ‘ã‚¿ãƒ¼ãƒ³: å„ Page ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ `useEffect` ã§ IndexedDB ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—

```typescript
// ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ä¸€è¦§
usePhrases()          â†’ PhraseRepository.getAll()
usePhrase(id)         â†’ PhraseRepository.getById(id)
useTakes(phraseId)    â†’ TakeRepository.getByPhraseId(phraseId)
useRecorder()         â†’ MediaRecorder åˆ¶å¾¡ï¼ˆstart / stop / blobï¼‰
useAnalyzer()         â†’ ãƒ”ãƒƒãƒåˆ†æå®Ÿè¡Œï¼ˆblob â†’ scoresï¼‰
useServiceWorker()    â†’ SW æ›´æ–°é€šçŸ¥åˆ¶å¾¡
```

---

## 7. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ç¢ºå®š

| é ˜åŸŸ | ãƒ©ã‚¤ãƒ–ãƒ©ãƒª | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç†ç”± | Article VIII |
|------|-----------|-----------|------|-------------|
| UI | React | 19.x | æ¨™æº–çš„ã€ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ å……å®Ÿ | ç›´æ¥ä½¿ç”¨ âœ… |
| è¨€èª | TypeScript | 5.x | å‹å®‰å…¨ | - |
| ãƒ“ãƒ«ãƒ‰ | Vite | 6.x | é«˜é€Ÿã€PWA ãƒ—ãƒ©ã‚°ã‚¤ãƒ³å¯¾å¿œ | ç›´æ¥ä½¿ç”¨ âœ… |
| ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | React Router | 7.x | SPA æ¨™æº– | ç›´æ¥ä½¿ç”¨ âœ… |
| DB | idb | 8.x | IndexedDB Promise wrapper | è–„ã„ãƒ©ãƒƒãƒ‘ãƒ¼ âœ… |
| ãƒ”ãƒƒãƒæ¤œå‡º | Pitchy | 4.x | è»½é‡ã€Web Audio API çµ±åˆ | ç›´æ¥ä½¿ç”¨ âœ… |
| PWA | vite-plugin-pwa | 0.21.x | Workbox çµ±åˆã€è‡ªå‹• SW ç”Ÿæˆ | ç›´æ¥ä½¿ç”¨ âœ… |
| ãƒ†ã‚¹ãƒˆ | Vitest | 3.x | Vite çµ±åˆã€é«˜é€Ÿ | ç›´æ¥ä½¿ç”¨ âœ… |
| UI ãƒ†ã‚¹ãƒˆ | @testing-library/react | 16.x | æ¨™æº– | ç›´æ¥ä½¿ç”¨ âœ… |
| CSS | Tailwind CSS | 4.x | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆ | ç›´æ¥ä½¿ç”¨ âœ… |
| ID ç”Ÿæˆ | crypto.randomUUID() | (æ¨™æº– API) | ä¾å­˜ãªã— | æ¨™æº– API âœ… |
| IDB ãƒ†ã‚¹ãƒˆ | fake-indexeddb | 6.x | Node.js ç’°å¢ƒç”¨ IndexedDB å®Ÿè£… | ä»•æ§˜æº–æ‹ å®Ÿè£… âœ… |

**ADR-006: Tailwind CSS æ¡ç”¨**
- æ±ºå®š: CSS-in-JS ã§ã¯ãªã Tailwind CSS ã‚’ä½¿ç”¨
- ç†ç”±: ã‚¼ãƒ­ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºæœ€å°ã€Vite ã¨ã®ç›¸æ€§è‰¯å¥½

---

## 8. PWA è¨­è¨ˆ

### 8.1 Service Worker æˆ¦ç•¥

```typescript
// vite.config.ts
import { VitePWA } from 'vite-plugin-pwa';

export default defineConfig({
  plugins: [
    VitePWA({
      registerType: 'prompt',           // PWA-003: æ‰‹å‹•æ›´æ–°
      workbox: {
        globPatterns: ['**/*.{js,css,html,ico,png,svg,woff2}'],
        runtimeCaching: []              // å¤–éƒ¨ API ãªã—
      },
      manifest: {                       // PWA-001
        name: 'RiffCard - æ­Œç·´ç¿’ã‚¢ãƒ—ãƒª',
        short_name: 'RiffCard',
        start_url: '/',
        display: 'standalone',
        background_color: '#1a1a2e',
        theme_color: '#e94560',
        icons: [
          { src: '/icons/icon-192.png', sizes: '192x192', type: 'image/png' },
          { src: '/icons/icon-512.png', sizes: '512x512', type: 'image/png' }
        ]
      }
    })
  ]
});
```

### 8.2 æ›´æ–°é€šçŸ¥ï¼ˆPWA-003ï¼‰

```typescript
// app/src/hooks/useServiceWorker.ts
// registerType: 'prompt' ã«ã‚ˆã‚Šã€æ›´æ–°æ¤œå‡ºæ™‚ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
// â†’ ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã€Œæ–°ã—ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒã‚ã‚Šã¾ã™ [æ›´æ–°ã™ã‚‹]ã€
```

### 8.3 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œï¼ˆPWA-002ï¼‰

- ã‚¢ãƒ—ãƒªã‚·ã‚§ãƒ«ï¼ˆHTML/CSS/JSï¼‰ã‚’ Service Worker ã§ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- IndexedDB ãƒ‡ãƒ¼ã‚¿ã¯ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§èª­ã¿æ›¸ãå¯èƒ½
- å¤–éƒ¨ API ãªã— â†’ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ä¾å­˜ã‚¼ãƒ­

---

## 9. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­è¨ˆ

| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | å¯¾å¿œè¦ä»¶ | UI è¡¨ç¾ |
|-----------|---------|--------|
| ãƒã‚¤ã‚¯æ¨©é™æ‹’å¦ | REC-002 | ã‚¨ãƒ©ãƒ¼ç”»é¢ + è¨­å®šæ‰‹é †ã‚¬ã‚¤ãƒ‰ |
| éŒ²éŸ³å¤±æ•— | REC-003 | ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ + ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ |
| éŸ³å£°å†ç”Ÿå¤±æ•— | PLAY-003 | ã‚¨ãƒ©ãƒ¼è¡¨ç¤º + å†éŒ²éŸ³ãƒœã‚¿ãƒ³ |
| IndexedDB æ›¸ãè¾¼ã¿å¤±æ•— | DATA-002 | ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã€Œä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€ |
| ãƒ”ãƒƒãƒåˆ†æå¤±æ•— | PITCH-006 | ã‚¨ãƒ©ãƒ¼è¡¨ç¤º + ãƒªãƒˆãƒ©ã‚¤ãƒœã‚¿ãƒ³ |
| MediaRecorder éå¯¾å¿œ | NFR-004 | ã‚¨ãƒ©ãƒ¼ç”»é¢ + Chrome æ¨å¥¨ã‚¬ã‚¤ãƒ‰ |

---

## 10. Architecture Decision Records (ADR)

### ADR-001: ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒãƒ¼ãªã—ã€å…¨å‡¦ç†ã‚’ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§å®Œçµ
- **ç†ç”±**: ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ï¼ˆéŸ³å£°ãƒ‡ãƒ¼ã‚¿å¤–éƒ¨é€ä¿¡ãªã—ï¼‰ã€é‹ç”¨ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ
- **å¯¾å¿œè¦ä»¶**: DATA-002, PWA-002
- **çµæœ**: âœ… ã‚µãƒ¼ãƒãƒ¼ä¸è¦ âœ… ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼å®Œå…¨ä¿è­· âŒ ãƒ‡ãƒã‚¤ã‚¹é–“åŒæœŸä¸å¯ï¼ˆPhase 1 ã‚¹ã‚³ãƒ¼ãƒ—å¤–ï¼‰

### ADR-002: idb ãƒ©ãƒƒãƒ‘ãƒ¼ä½¿ç”¨

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: IndexedDB ç›´æ¥æ“ä½œã§ã¯ãªã `idb` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨
- **ç†ç”±**: Promise APIã€å‹å®‰å…¨ã€ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šæ¸›
- **Article VIII**: idb ã¯è–„ã„ Promise ãƒ©ãƒƒãƒ‘ãƒ¼ã§ã‚ã‚Šç‹¬è‡ªæŠ½è±¡åŒ–ã§ã¯ãªã„ âœ…

### ADR-003: MediaRecorder + opus/webm

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: `audio/webm;codecs=opus` ã‚’ãƒ—ãƒ©ã‚¤ãƒãƒªã€`audio/webm` ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
- **ç†ç”±**: é«˜åœ§ç¸®ãƒ»é«˜å“è³ªã€Chrome/Firefox/Edge æ¨™æº–å¯¾å¿œ
- **Safari**: iOS 14.3+ ã§å¯¾å¿œæ¸ˆã¿ã€‚éå¯¾å¿œæ™‚ã¯ã‚¨ãƒ©ãƒ¼ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹è¡¨ç¤º

### ADR-004: DTWï¼ˆDynamic Time Warpingï¼‰

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: ãƒ†ãƒ³ãƒã®æºã‚Œã‚’å¸åã™ã‚‹ãŸã‚ DTW ã§ã‚¢ãƒ©ã‚¤ãƒ¡ãƒ³ãƒˆ
- **ç†ç”±**: ç·´ç¿’ãƒ†ã‚¤ã‚¯ã¯ãŠæ‰‹æœ¬ã¨å®Œå…¨ã«åŒã˜ãƒ†ãƒ³ãƒã«ãªã‚‰ãªã„
- **å®Ÿè£…**: è»½é‡è‡ªå‰å®Ÿè£…ï¼ˆã€œ100ãƒ•ãƒ¬ãƒ¼ãƒ ç¨‹åº¦ã§ O(nÂ²) ååˆ†ï¼‰
- **Article I**: lib/audio/src/dtw.ts ã¨ã—ã¦ Library-First ã§å®Ÿè£…

### ADR-005: React æ¨™æº–çŠ¶æ…‹ç®¡ç†

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: useState / useContext ã®ã¿ã€‚å¤–éƒ¨çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸ä½¿ç”¨
- **ç†ç”±**: ç”»é¢é–“ã§å…±æœ‰ã™ã‚‹çŠ¶æ…‹ãŒã»ã¼ãªã„ã€‚Article VIII æº–æ‹ 
- **ä»£æ›¿æ¡ˆå´ä¸‹**: Reduxï¼ˆéå‰°ï¼‰ã€Zustandï¼ˆä¸è¦ãªä¾å­˜è¿½åŠ ï¼‰

### ADR-006: Tailwind CSS

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: Tailwind CSS 4.x ã‚’ä½¿ç”¨
- **ç†ç”±**: ã‚¼ãƒ­ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã€ãƒ“ãƒ«ãƒ‰ã‚µã‚¤ã‚ºæœ€å°ã€Vite ã¨ã®ç›¸æ€§è‰¯å¥½ã€Mobile-first å¯¾å¿œ

### ADR-007: 2å±¤ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«ï¼ˆNote å»ƒæ­¢ï¼‰

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Acceptedï¼ˆDJ-001ï¼‰
- **æ±ºå®š**: Note å±¤ã‚’å»ƒæ­¢ã— Phrase â†’ Take ã®2å±¤ãƒ•ãƒ©ãƒƒãƒˆæ§‹é€ ã«å¤‰æ›´
- **ç†ç”±**: MVP ã§ã¯æ›²å˜ä½ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°ã¯ä¸è¦ã€‚æ“ä½œéšå±¤ãŒ1ã¤æ¸›ã‚Šãƒ•ãƒ­ãƒ¼çŠ¶æ…‹ã‚’ç¶­æŒã—ã‚„ã™ã„
- **çµæœ**: âœ… ç”»é¢æ•°å‰Šæ¸›ï¼ˆ6â†’5ï¼‰ âœ… ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç°¡ç´ åŒ– âŒ å°†æ¥ã®ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°æ©Ÿèƒ½ã¯ Phase 2+ ã§æ¤œè¨

### ADR-008: æ‘©æ“¦ã‚¼ãƒ­ãƒ•ãƒ¬ãƒ¼ã‚ºä½œæˆ

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Acceptedï¼ˆDJ-003ï¼‰
- **æ±ºå®š**: ãƒ•ãƒ¬ãƒ¼ã‚ºä½œæˆæ™‚ã«åå‰å…¥åŠ›ã‚’çœç•¥ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆåã§å³ãŠæ‰‹æœ¬éŒ²éŸ³é–‹å§‹
- **ç†ç”±**: åå‰å…¥åŠ›ã‚¹ãƒ†ãƒƒãƒ—ãŒãƒ•ãƒ­ãƒ¼çŠ¶æ…‹ï¼ˆP8 å‹•æ©Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã‚’é€”åˆ‡ã‚Œã•ã›ã‚‹ã€‚å‰æ‰•ã„é€²æ—åŠ¹æœï¼ˆP3ï¼‰ã§ã€Œã‚‚ã†å§‹ã¾ã£ã¦ã‚‹ã€æ„Ÿã‚’æ¼”å‡º
- **çµæœ**: âœ… ä½œæˆâ†’éŒ²éŸ³ãŒ1ã‚¿ãƒƒãƒ— âœ… å¾Œã‹ã‚‰åå‰ç·¨é›†å¯èƒ½

### ADR-009: CLI ç’°å¢ƒã§ã® IndexedDB ä»£æ›¿

- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: Accepted
- **æ±ºå®š**: CLI ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°ç”¨ã« `fake-indexeddb` ã‚’ä½¿ç”¨
- **ç†ç”±**: IndexedDB ã¯ãƒ–ãƒ©ã‚¦ã‚¶å°‚ç”¨ APIã€‚`fake-indexeddb` ã¯ IndexedDB ä»•æ§˜æº–æ‹ ã®ç´”ç²‹ãª JS å®Ÿè£…
- **Article IX**: ãƒ¢ãƒƒã‚¯ã§ã¯ãªãä»•æ§˜æº–æ‹ å®Ÿè£…ã®ãŸã‚ Integration-First Testing ã«é©åˆ

---

## 11. è¦ä»¶ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãƒãƒˆãƒªã‚¯ã‚¹

### Phase 1 å…¨è¦ä»¶ï¼ˆ32ä»¶ï¼‰

| è¦ä»¶ID | è¦ä»¶æ¦‚è¦ | è¨­è¨ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ / ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£ |
|--------|---------|--------------|------------------------|------|
| DATA-001 | ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾© | 3.1 ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£å®šç¾© | lib/db/src/types.ts | âš ï¸ 2å±¤ã«å¤‰æ›´ |
| DATA-002 | IndexedDB æ°¸ç¶šåŒ– | 3.2 IndexedDB ã‚¹ã‚­ãƒ¼ãƒ | lib/db/src/schema.ts, repository.ts | - |
| DATA-003 | Phrase ä½œæˆï¼ˆæ—§Noteï¼‰ | 4.3 S1 ãƒ•ãƒ¬ãƒ¼ã‚ºä¸€è¦§ | PhraseListPage, FAB | âš ï¸ Phraseå³ä½œæˆ |
| DATA-004 | Phrase ä½œæˆâ†’éŒ²éŸ³ | 4.3 S2 ãŠæ‰‹æœ¬éŒ²éŸ³ | ReferenceRecordPage | âš ï¸ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå |
| DATA-005 | ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ | 3.4 ã‚«ã‚¹ã‚±ãƒ¼ãƒ‰å‰Šé™¤ | lib/db/src/repository.ts | âš ï¸ Phraseå˜ä½ |
| REC-001 | ãƒã‚¤ã‚¯æ¨©é™è¦æ±‚ | 5.1 éŒ²éŸ³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ | lib/audio/src/recorder.ts, useRecorder.ts | - |
| REC-002 | ãƒã‚¤ã‚¯æ¨©é™æ‹’å¦ã‚¨ãƒ©ãƒ¼ | 9 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | lib/audio/src/errors.ts, useRecorder.ts | - |
| REC-003 | éŒ²éŸ³ä¸­ã®éŸ³å£°ã‚­ãƒ£ãƒ—ãƒãƒ£ | 5.1 éŒ²éŸ³ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ | AudioRecorder, WaveformVisualizer | - |
| REC-004 | ãŠæ‰‹æœ¬éŒ²éŸ³ä¿å­˜ | 4.3 S2 ãŠæ‰‹æœ¬éŒ²éŸ³ | ReferenceRecordPage, repository.ts | - |
| REC-005 | ç·´ç¿’éŒ²éŸ³â†’è‡ªå‹•åˆ†æ | 4.3 S4 ç·´ç¿’éŒ²éŸ³ | PracticeRecordPage, useAnalyzer.ts | - |
| REC-006 | ãŠæ‰‹æœ¬å†éŒ²éŸ³ | 4.3 S3 ãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´° | PhraseDetailPage, repository.ts | - |
| PLAY-001 | ãŠæ‰‹æœ¬å†ç”Ÿ | 4.3 S3 ãƒ•ãƒ¬ãƒ¼ã‚ºè©³ç´° | AudioPlayer | - |
| PLAY-002 | ãƒ†ã‚¤ã‚¯å†ç”Ÿ | 4.3 S3, S5 | AudioPlayer, TakeItem | - |
| PLAY-003 | å†ç”Ÿå¤±æ•—ã‚¨ãƒ©ãƒ¼ | 9 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | AudioPlayer | - |
| PITCH-001 | ãƒ”ãƒƒãƒåˆ†æãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ | 5.2 ãƒ”ãƒƒãƒåˆ†æ | lib/audio/src/analyzer.ts | - |
| PITCH-002 | MIDI å¤‰æ› | 5.2 ãƒ”ãƒƒãƒåˆ†æ | lib/audio/src/analyzer.ts | - |
| PITCH-003 | ç·åˆã‚¹ã‚³ã‚¢è¨ˆç®— | 5.3 ã‚¹ã‚³ã‚¢è¨ˆç®— | lib/audio/src/scoring.ts | - |
| PITCH-004 | Â±50cent åˆ¤å®š | 5.3 ã‚¹ã‚³ã‚¢è¨ˆç®— | lib/audio/src/scoring.ts | - |
| PITCH-005 | ã‚¹ã‚³ã‚¢è¡¨ç¤º | 4.3 S5 ã‚¹ã‚³ã‚¢çµæœ | ScoreDisplay, ScoreResultPage | - |
| PITCH-006 | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³éŸ³å£°åˆ†æ | 5.2 ãƒ”ãƒƒãƒåˆ†æ | lib/audio/src/analyzer.ts | - |
| PWA-001 | PWA ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¯èƒ½ | 8.1 SW æˆ¦ç•¥ | vite.config.ts, manifest.json | - |
| PWA-002 | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ | 8.3 ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ | vite-plugin-pwa (Workbox) | - |
| PWA-003 | SW æ›´æ–°é€šçŸ¥ | 8.2 æ›´æ–°é€šçŸ¥ | useServiceWorker.ts | - |
| UX-001 | åˆå› CTA | 4.3 S1 ç©ºçŠ¶æ…‹ | EmptyState | âš ï¸ Phrase CTA |
| UX-002 | åˆå›éŒ²éŸ³å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | 4.3 S2â†’S3 é·ç§» | ReferenceRecordPage | - |
| UX-003 | ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—ç·´ç¿’é–‹å§‹ | 4.3 S1, S3 | PhraseCard, PracticeButton | - |
| UX-004 | ã‚‚ã†ä¸€åº¦ãƒœã‚¿ãƒ³ | 4.3 S5 ã‚¹ã‚³ã‚¢çµæœ | RetryButton, ScoreResultPage | - |
| UX-005 | ç©ºçŠ¶æ…‹è¡¨ç¤º | 4.3 S1 ç©ºçŠ¶æ…‹ | EmptyState | âš ï¸ Phrase ç©ºçŠ¶æ…‹ |
| NFR-001 | 3ç§’ä»¥å†…ãƒ­ãƒ¼ãƒ‰ | 7 æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ | Vite + Tailwindï¼ˆè»½é‡ãƒãƒ³ãƒ‰ãƒ«ï¼‰ | - |
| NFR-002 | ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– 320-1440px | 6.3 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ | Tailwind responsive classes | - |
| NFR-003 | 5åˆ†éŒ²éŸ³ã§UIå›ºã¾ã‚‰ãªã„ | 5.2 ãƒ”ãƒƒãƒåˆ†æ | OfflineAudioContextï¼ˆéåŒæœŸå‡¦ç†ï¼‰ | - |
| NFR-004 | ãƒ–ãƒ©ã‚¦ã‚¶äº’æ›æ€§ | 9 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | recorder.ts ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | - |

### ã‚«ãƒãƒ¬ãƒƒã‚¸æ¤œè¨¼

- **Phase 1 è¦ä»¶æ•°**: 32
- **ãƒãƒƒãƒ”ãƒ³ã‚°æ¸ˆã¿**: 32ï¼ˆ100%ï¼‰
- **æœªãƒãƒƒãƒ”ãƒ³ã‚°**: 0 âœ…
- **ä¿®æ­£è¦ä»¶**: 6ï¼ˆDJ-001, DJ-003 ã«ã‚ˆã‚‹å¤‰æ›´ã€‚âš ï¸ ãƒãƒ¼ã‚¯ã§è¨˜è¼‰ï¼‰

---

## 12. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆï¼ˆå…¨ä½“ï¼‰

```
riffcard/
â”œâ”€â”€ lib/                              # Article I: Library-First
â”‚   â”œâ”€â”€ db/                           # ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ types.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ repository.ts
â”‚   â”‚   â”‚   â””â”€â”€ errors.ts
â”‚   â”‚   â”œâ”€â”€ tests/
â”‚   â”‚   â”‚   â””â”€â”€ repository.test.ts
â”‚   â”‚   â””â”€â”€ cli.ts                    # Article II
â”‚   â”‚
â”‚   â””â”€â”€ audio/                        # éŸ³å£°å‡¦ç†å±¤
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ index.ts
â”‚       â”‚   â”œâ”€â”€ types.ts
â”‚       â”‚   â”œâ”€â”€ recorder.ts
â”‚       â”‚   â”œâ”€â”€ analyzer.ts
â”‚       â”‚   â”œâ”€â”€ scoring.ts
â”‚       â”‚   â”œâ”€â”€ dtw.ts
â”‚       â”‚   â””â”€â”€ errors.ts
â”‚       â”œâ”€â”€ tests/
â”‚       â”‚   â”œâ”€â”€ analyzer.test.ts
â”‚       â”‚   â”œâ”€â”€ scoring.test.ts
â”‚       â”‚   â””â”€â”€ dtw.test.ts
â”‚       â””â”€â”€ cli.ts                    # Article II
â”‚
â”œâ”€â”€ app/                              # React ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ main.tsx
â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”œâ”€â”€ PhraseListPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ReferenceRecordPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PhraseDetailPage.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PracticeRecordPage.tsx
â”‚   â”‚   â”‚   â””â”€â”€ ScoreResultPage.tsx
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioRecorder.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ AudioPlayer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ WaveformVisualizer.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ PhraseCard.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ TakeItem.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ScoreDisplay.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EmptyState.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ ConfirmDialog.tsx
â”‚   â”‚   â”‚   â””â”€â”€ BackButton.tsx
â”‚   â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”‚   â”œâ”€â”€ usePhrases.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ usePhrase.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useTakes.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useRecorder.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ useAnalyzer.ts
â”‚   â”‚   â”‚   â””â”€â”€ useServiceWorker.ts
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â””â”€â”€ global.css
â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â”œâ”€â”€ manifest.json
â”‚   â”‚   â””â”€â”€ icons/
â”‚   â””â”€â”€ index.html
â”‚
â”œâ”€â”€ storage/                          # SDD æˆæœç‰©
â”‚   â”œâ”€â”€ design/
â”‚   â”‚   â”œâ”€â”€ phase1-mvp-design.ja.md   # â† æœ¬ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ phase1-mvp-design.md      # ãƒ‰ãƒ©ãƒ•ãƒˆå‚è€ƒ
â”‚   â”œâ”€â”€ specs/
â”‚   â”œâ”€â”€ tasks/
â”‚   â””â”€â”€ validation/
â”‚
â”œâ”€â”€ steering/                         # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¡ãƒ¢ãƒª
â”‚   â”œâ”€â”€ product.ja.md
â”‚   â”œâ”€â”€ tech.ja.md
â”‚   â”œâ”€â”€ structure.ja.md
â”‚   â”œâ”€â”€ requirements.ja.md
â”‚   â”œâ”€â”€ rules/
â”‚   â”‚   â””â”€â”€ constitution.md
â”‚   â””â”€â”€ memories/
â”‚       â””â”€â”€ flutter-learnings.md
â”‚
â”œâ”€â”€ package.json
â”œâ”€â”€ tsconfig.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ vitest.config.ts
```

---

## 13. æ†²æ³•æº–æ‹ ãƒã‚§ãƒƒã‚¯

### Article I: Library-First âœ…

- å…¨æ©Ÿèƒ½ã‚’ `lib/db/` ã¨ `lib/audio/` ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦å®Ÿè£…
- å„ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ç‹¬ç«‹ã—ãŸãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã‚’æŒã¤
- Public API ã¯ `src/index.ts` ã§ export
- ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ã¸ã®ä¾å­˜ãªã—

### Article II: CLI Interface âœ…

- `lib/db/cli.ts`: Phrase/Take ã® CRUD æ“ä½œ
- `lib/audio/cli.ts`: éŸ³å£°åˆ†æãƒ»ã‚¹ã‚³ã‚¢è¨ˆç®—
- ãƒ˜ãƒ«ãƒ—ãƒ†ã‚­ã‚¹ãƒˆãƒ»çµ‚äº†ã‚³ãƒ¼ãƒ‰è¦ç´„ã«æº–æ‹ 

### Article III: Test-First âœ…ï¼ˆå®Ÿè£…æ™‚ã«é©ç”¨ï¼‰

- ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã‚’è¨­è¨ˆã«å«ã‚€
- `fake-indexeddb` ã§ãƒªãƒã‚¸ãƒˆãƒªãƒ†ã‚¹ãƒˆ
- ã‚¹ã‚³ã‚¢è¨ˆç®—ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆè¨­è¨ˆ

### Article IV: EARS Format âœ…

- requirements.ja.md ã®å…¨è¦ä»¶ãŒ EARS å½¢å¼
- ä¿®æ­£è¦ä»¶ã‚‚ EARS ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æº–æ‹ 

### Article V: Traceability âœ…

- ã‚»ã‚¯ã‚·ãƒ§ãƒ³ 11 ã§å…¨32è¦ä»¶ã®ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ãƒãƒˆãƒªã‚¯ã‚¹ã‚’è¨˜è¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸ 100%ï¼ˆ32/32ï¼‰
- ä¿®æ­£è¦ä»¶ã¯ âš ï¸ ãƒãƒ¼ã‚¯ã§è­˜åˆ¥å¯èƒ½

### Article VI: Project Memory âœ…

- steering/ é…ä¸‹ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã—ãŸä¸Šã§è¨­è¨ˆ
- product.ja.md ã®ãƒ“ã‚¸ãƒ§ãƒ³ãƒ»å‹•æ©Ÿãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åæ˜ 
- flutter-learnings.md ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ç¶™æ‰¿

### Article VII: Simplicity Gate âœ…

- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ•°: 1ï¼ˆriffcard ãƒ¢ãƒãƒ¬ãƒï¼‰
- ä¸Šé™3ä»¥å†… âœ…

### Article VIII: Anti-Abstraction âœ…

- å…¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ API ã‚’ç›´æ¥ä½¿ç”¨
- idb ã¯è–„ã„ Promise ãƒ©ãƒƒãƒ‘ãƒ¼ï¼ˆç‹¬è‡ªæŠ½è±¡åŒ–ã§ã¯ãªã„ï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒ©ãƒƒãƒ‘ãƒ¼ãªã—

### Article IX: Integration-First Testing âœ…

- `fake-indexeddb` ã¯ IndexedDB ä»•æ§˜æº–æ‹ å®Ÿè£…ï¼ˆãƒ¢ãƒƒã‚¯ã§ã¯ãªã„ï¼‰
- Web Audio API ãƒ†ã‚¹ãƒˆã¯åˆæˆãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨

---

## 14. è¨­è¨ˆã‚µãƒãƒª

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

- **ãƒ‘ã‚¿ãƒ¼ãƒ³**: Library-First ãƒ¢ãƒãƒ¬ãƒï¼ˆã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹ PWAï¼‰
- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ•°**: 2ãƒ©ã‚¤ãƒ–ãƒ©ãƒª + 1ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- **ç”»é¢æ•°**: 5ç”»é¢
- **ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆã‚¢**: IndexedDBï¼ˆ2ãƒ†ãƒ¼ãƒ–ãƒ«: phrases, takesï¼‰

### è¦ä»¶ã‚«ãƒãƒ¬ãƒƒã‚¸

- **Phase 1 è¦ä»¶æ•°**: 32
- **ãƒãƒƒãƒ”ãƒ³ã‚°æ¸ˆã¿**: 32ï¼ˆ100%ï¼‰ âœ…
- **ä¿®æ­£è¦ä»¶**: 6ï¼ˆè¨­è¨ˆåˆ¤æ–­ DJ-001ã€œ003 ã«ã‚ˆã‚‹ï¼‰

### ADR æ•°

- ADR-001ã€œ009ï¼ˆ9ä»¶ï¼‰

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. è¨­è¨ˆãƒ¬ãƒ“ãƒ¥ãƒ¼
2. ã‚¿ã‚¹ã‚¯åˆ†è§£: `/sdd-tasks phase1-mvp`
3. å®Ÿè£…é–‹å§‹: `/sdd-implement phase1-mvp`

---

## å‚ç…§

- è¦ä»¶å®šç¾©: `steering/requirements.ja.md`
- ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆ: `steering/product.ja.md`
- æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯: `steering/tech.ja.md`
- æ†²æ³•: `steering/rules/constitution.md`
- Flutter çŸ¥è¦‹: `steering/memories/flutter-learnings.md`
- ãƒ‰ãƒ©ãƒ•ãƒˆè¨­è¨ˆ: `storage/design/phase1-mvp-design.md`

---

**æœ€çµ‚æ›´æ–°**: 2026-02-20
**æ‹…å½“**: imudak / ã‚¯ãƒ­ã‚¦å€™
**MUSUBI Version**: 0.1.0
