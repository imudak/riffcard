# Product Context — RiffCard

**プロジェクト**: riffcard
**最終更新**: 2026-02-20
**バージョン**: 1.1

---

## プロダクトビジョン

**ビジョン**: 「歌いたいフレーズを、何度でも練習できる場所」

歌が上手くなりたいすべての人に、ボイストレーナーなしで自主練できる環境を届ける。
単語帳アプリが語学学習を変えたように、RiffCardは歌の練習を変える。

**ミッション**: フレーズ単位の繰り返し練習を、スコアで上達が見えるシンプルなPWAとして実現する。

---

## プロダクト概要

### RiffCardとは？

歌のフレーズを繰り返し練習する「音楽版英単語帳」PWA。

英単語帳アプリが「単語→意味→テスト」の繰り返しで学習効率を高めるように、
RiffCardは「お手本録音→練習録音→ピッチスコア」の繰り返しで歌の上達を実現する。

### 解決する課題

- **課題**: カラオケでサビの高音が出ない、特定フレーズを集中練習したいが方法がない
- **現状の問題**: ボイストレーナーに頼ると週1回・高コスト。カラオケで全曲通しでは非効率
- **RiffCardの解法**: フレーズ単位で切り出し、お手本と比較しながら何度でも練習できる

### ユニークな価値

1. **フレーズ単位**: 曲全体ではなく「サビの高音だけ」を集中練習できる
2. **ピッチスコア**: 感覚的な「上手くなった気」ではなく数値で上達を確認できる
3. **PWA**: インストール不要、スマホでもデスクトップでもオフラインで動く

---

## ターゲットユーザー

### プライマリユーザー: カラオケ自主練ユーザー

**プロファイル**:
- 年齢: 20〜40代
- カラオケが好きだが特定のフレーズ（サビ、高音部分）が苦手
- ボーカルレッスンに通うほどではないが真剣に上手くなりたい
- スマートフォンに慣れており、アプリのインストールより即使えるものを好む

**ゴール**:
- 苦手フレーズを短期間で克服したい
- 練習の成果を客観的に確認したい
- 隙間時間（通勤中、就寝前）に練習したい

**ペインポイント**:
- カラオケで全曲通すと練習効率が悪い
- 自分が上手くなっているかどうかわからない
- ボイトレに通う時間・お金がない

---

### セカンダリユーザー: ボーカルレッスン受講者

- レッスンで習ったフレーズを自宅で反復練習したい
- 先生のお手本を録音して練習素材として使いたい

---

## 動機パターン（設計方針の根拠）

ユーザーのエンゲージメントを維持する動機パターンを設計に組み込む:

| 優先度 | 動機パターン | RiffCardでの実装 |
|--------|------------|----------------|
| **P1** | ストリーク | 毎日の練習記録・連続日数表示（Phase 3） |
| **P3** | 前払い進捗効果 | 初回で1フレーズ録音完了 →「もう始まってる」感 |
| **P8** | フロー状態 | フレーズ選択→即録音開始、選択肢で迷わせない |
| **P13** | 作品化欲求 | スコア推移グラフ = 成長の可視化（Phase 3） |

---

## コア機能（フェーズ別）

### Phase 1 MVP: 「録音→スコア」ループ（P0）

1. **フレーズ管理**
   - Note（ノートブック）→ Phrase（フレーズ）→ Take（練習テイク）の3層モデル
   - IndexedDBによる完全ローカル保存

2. **お手本録音**
   - マイクで自分のお手本フレーズを録音（MediaRecorder API / opus/webm）
   - フレーズごとにお手本音声を保存

3. **練習録音とスコア**
   - ワンタップで練習録音開始
   - ピッチ精度（70%）+ リズム精度（30%）でスコア計算
   - ±50cent以内を「正確」と判定

4. **PWA**
   - インストール可能、オフライン動作

### Phase 2: リアルタイムフィードバック（P1）

5. **リアルタイムピッチ表示**: 録音中にピッチ曲線をリアルタイム描画
6. **お手本比較**: お手本と練習の波形比較グラフ

### Phase 3: 習慣化・成長可視化（P2）

7. **ストリーク**: 連続練習日数の記録・表示（P1動機）
8. **スコア推移グラフ**: フレーズごとの上達曲線（P13動機）

---

## 技術スタック概要

| 領域 | 技術 |
|------|------|
| フロントエンド | React + TypeScript + Vite |
| ピッチ検出 | Web Audio API + Pitchy.js |
| 録音 | MediaRecorder API（opus/webm） |
| ストレージ | IndexedDB（音声Blob含む） |
| PWA | Service Worker + manifest.json |
| デプロイ | Cloudflare Pages または Vercel |

詳細: `steering/tech.ja.md`

---

## デザイン原則

1. **フロー最優先**: フレーズを選んだら即練習開始。選択肢で迷わせない（P8）
2. **スコアで動機づけ**: 数値と可視化で「上達している」を実感させる（P13）
3. **ローカルファースト**: データはすべてデバイス内。プライバシー重視、サーバー不要
4. **Mobile-First**: スマホで片手操作を前提としたUI設計

---

## 成功指標

### Phase 1 リリース基準

| 指標 | 目標 |
|------|------|
| フレーズ録音→スコア表示が完結 | 必須 |
| オフライン動作 | 必須 |
| Lighthouse Performance | ≥ 80 |
| iOS Safari / Android Chrome で動作 | 必須 |

### Phase 2 以降

| 指標 | 目標 |
|------|------|
| 1週間後リテンション | > 30% |
| 1セッションあたりのTake数 | > 3回 |
| ストリーク継続率（3日以上） | > 20% |

---

## プロダクトロードマップ

### Phase 1: MVP（1〜2ヶ月）

**ゴール**: フレーズを録音して再生し、ピッチスコアが出る

**機能**:
- Note/Phrase/TakeのCRUD
- お手本録音・練習録音
- ピッチスコア計算・表示（FFT + Pitchy.js）
- PWAオフライン対応

**成功基準**:
- 1フレーズの録音→スコアまでの流れが3分以内に完結する
- スマホで快適に操作できる

---

### Phase 2: リアルタイム（3〜4ヶ月）

**ゴール**: 録音中にリアルタイムでフィードバックを受けられる

**機能**:
- 録音中リアルタイムピッチグラフ
- お手本との重ね合わせ比較

---

### Phase 3: 習慣化（5〜6ヶ月）

**ゴール**: 毎日続けたくなる

**機能**:
- ストリーク（連続練習日数）
- スコア推移グラフ（Phraseごとの成長可視化）

---

## ドメイン概念

| 概念 | 定義 |
|------|------|
| **Note** | 曲や練習テーマをまとめるノートブック（例:「Lemon - 米津玄師」） |
| **Phrase** | 練習する歌のフレーズ（例:「サビの高音部分」） |
| **Reference** | Phraseのお手本録音音声 |
| **Take** | 1回の練習録音とそのスコア |
| **Pitch Score** | ピッチ精度スコア（0-100, 70%重み） |
| **Rhythm Score** | リズム精度スコア（0-100, 30%重み） |
| **Total Score** | ピッチ×0.7 + リズム×0.3 の総合スコア |
| **Streak** | 連続練習日数 |

---

## ビジネスコンテキスト

- **収益モデル**: 個人プロジェクト（当面無料公開）
- **ターゲット規模**: 個人利用〜数百ユーザー（Phase 1）
- **コンプライアンス**: 音声データは全てローカル保存 → プライバシー問題なし
- **チーム**: imudak（1名）+ クロウ候（AI）

---

## 参照

- 要件定義: `steering/requirements.ja.md`
- 技術詳細: `steering/tech.ja.md`
- Flutter版知見: `steering/memories/flutter-learnings.md`
- 憲法: `steering/rules/constitution.md`

---

**最終更新**: 2026-02-20
**担当**: imudak / クロウ候
